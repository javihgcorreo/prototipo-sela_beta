# Prototipo SELA - Sistema de Microservicios para GestiÃ³n de Datos

## ğŸ“‹ DescripciÃ³n
**SELA** (Sistema de E-Learning Avanzado) es un prototipo de arquitectura de microservicios diseÃ±ado para gestionar datos educativos con funcionalidades de anonimizaciÃ³n y auditorÃ­a. El sistema permite procesar informaciÃ³n sensible manteniendo trazabilidad completa de todas las operaciones realizadas.

## ğŸ—ï¸ Arquitectura

```
prototipo-sela_beta/
â”œâ”€â”€ servicio-sela/              # Servicio principal de coordinaciÃ³n (Puerto 8000)
â”œâ”€â”€ servicio-anonimizacion/     # Servicio de tratamiento de datos sensibles (Puerto 8001)
â”œâ”€â”€ servicio-auditoria/         # Servicio de registro y trazabilidad (Puerto 8002)
â”œâ”€â”€ actualizar-sela.ps1         # Script de automatizaciÃ³n para despliegue (Windows)
â”œâ”€â”€ docker-compose.yml          # OrquestaciÃ³n de todos los servicios
â”œâ”€â”€ guionTestPrueba.txt         # Scripts SQL para pruebas y validaciÃ³n
â””â”€â”€ README.md                   # Este archivo
```

## ğŸš€ Comenzando

### Prerrequisitos
- **Docker** versiÃ³n 20.10 o superior
- **Docker Compose** versiÃ³n 2.0 o superior
- **Git** para clonar el repositorio
- (Opcional) **Python 3.12.5** para desarrollo local

### InstalaciÃ³n RÃ¡pida

#### OpciÃ³n 1: Usando Docker Compose (Recomendado)
```bash
# 1. Clonar el repositorio
git clone https://github.com/javihgcorreo/prototipo-sela_beta.git
cd prototipo-sela_beta

# 2. Iniciar todos los servicios
docker-compose up --build

# 3. Verificar que los servicios estÃ¡n funcionando
docker-compose ps
```

#### OpciÃ³n 2: Usando el Script de AutomatizaciÃ³n (Windows)
```powershell
# Ejecutar el script de comprobaciÃ³n
.\comprobarservicios-sela.ps1

# El script realizarÃ¡ automÃ¡ticamente: la comprobaciÃ³n de los servicios

```

#### OpciÃ³n 3: Desarrollo Local (Sin Docker)
```bash
# Para cada servicio, ejecutar:
cd servicio-sela
python -m venv venv
source venv/bin/activate  # En Windows: venv\Scripts\activate
pip install -r requirements.txt
python app.py
```

## ğŸ“¡ Servicios y Endpoints

### ğŸ”¹ Servicio Principal SELA (Puerto 8000)
**Responsabilidad**: CoordinaciÃ³n principal y gateway de operaciones.

**Endpoints principales**:
- `GET /` - Estado del servicio
- `POST /procesar` - Iniciar procesamiento de datos
- `GET /estado/<id_proceso>` - Consultar estado de procesamiento

### ğŸ”¹ Servicio de AnonimizaciÃ³n (Puerto 8001)
**Responsabilidad**: Tratamiento y anonimizaciÃ³n de datos sensibles.

**Endpoints principales**:
- `POST /anonimizar` - Anonimizar conjunto de datos
- `GET /tecnicas` - Listar tÃ©cnicas de anonimizaciÃ³n disponibles
- `POST /validar` - Validar calidad de anonimizaciÃ³n

### ğŸ”¹ Servicio de AuditorÃ­a (Puerto 8002)
**Responsabilidad**: Registro y trazabilidad de todas las operaciones.

**Endpoints principales**:
- `POST /registrar` - Registrar nueva operaciÃ³n
- `GET /historial` - Consultar historial de operaciones
- `GET /reporte/<fecha>` - Generar reporte por fecha

## ğŸ—„ï¸ Base de Datos

El sistema utiliza **PostgreSQL** para almacenar registros de auditorÃ­a:

- **Contenedor**: `postgres:15-alpine`
- **Puerto**: 5432
- **Base de datos**: `auditoria_db`
- **Usuario**: `auditoria_user`
- **ContraseÃ±a**: `auditoria_pass` *(Â¡Cambiar en producciÃ³n!)*

### Estructura de la base de datos:
```sql
-- Ejemplo de consulta (ver guionTestPrueba.txt completo)
SELECT * FROM operaciones_auditoria 
WHERE fecha >= NOW() - INTERVAL '1 day';
```

## ğŸ”§ ConfiguraciÃ³n

### Variables de Entorno
Crea un archivo `.env` en la raÃ­z del proyecto:

```env
# Servicio SELA
SELA_HOST=0.0.0.0
SELA_PORT=8000

# Servicio AnonimizaciÃ³n
ANON_HOST=0.0.0.0
ANON_PORT=8001

# Servicio AuditorÃ­a
AUDIT_HOST=0.0.0.0
AUDIT_PORT=8002

# Base de Datos PostgreSQL
POSTGRES_USER=auditoria_user
POSTGRES_PASSWORD=tu_password_seguro  # Â¡CAMBIAR!
POSTGRES_DB=auditoria_db
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
```

### ConfiguraciÃ³n de Docker Compose
El archivo `docker-compose.yml` define:
- 4 contenedores interconectados
- Redes aisladas para comunicaciÃ³n interna
- VolÃºmenes persistentes para la base de datos
- Health checks para monitoreo

## ğŸ§ª Pruebas y ValidaciÃ³n

### Pruebas Automatizadas
```bash
# Ejecutar suite de pruebas
docker-compose exec servicio-sela python -m pytest tests/

# Ver logs en tiempo real
docker-compose logs --follow servicio-sela

# Probar conectividad entre servicios
docker-compose exec servicio-sela curl http://servicio-anonimizacion:8001/health
```

### Pruebas Manuales con cURL
```bash
# Verificar estado del servicio principal
curl http://localhost:8000/

# Procesar datos de ejemplo
curl -X POST http://localhost:8000/procesar \
  -H "Content-Type: application/json" \
  -d '{"datos": "ejemplo", "accion": "anonimizar"}'

# Consultar historial de auditorÃ­a
curl http://localhost:8002/historial
```

### Scripts de Prueba SQL
El archivo `guionTestPrueba.txt` contiene consultas SQL preparadas para:
- InserciÃ³n de datos de prueba
- ValidaciÃ³n de integridad referencial
- GeneraciÃ³n de reportes de auditorÃ­a

## ğŸ“¦ Dependencias

### Servicio SELA (`servicio-sela/`)
```txt
Flask==2.3.3
requests==2.31.0
psycopg2-binary==2.9.7
python-dotenv==1.0.0
```

### Servicio AnonimizaciÃ³n (`servicio-anonimizacion/`)
```txt
Flask==2.3.3
pandas==2.0.3
numpy==1.24.3
scikit-learn==1.3.0
```

### Servicio AuditorÃ­a (`servicio-auditoria/`)
```txt
Flask==2.3.3
psycopg2-binary==2.9.7
SQLAlchemy==2.0.19
```

## ğŸ”„ Script de AutomatizaciÃ³n

El script `actualizar-sela.ps1` proporciona automatizaciÃ³n completa:

```powershell
# Uso bÃ¡sico
.\actualizar-sela.ps1

# Funcionalidades:
# 1. ActualizaciÃ³n automÃ¡tica del cÃ³digo desde Git
# 2. ReconstrucciÃ³n inteligente de imÃ¡genes Docker
# 3. Reinicio controlado de contenedores
# 4. VerificaciÃ³n de salud de servicios
# 5. Limpieza de recursos no utilizados
```

## ğŸ› SoluciÃ³n de Problemas

### Problemas Comunes y Soluciones

| Problema | Causa Probable | SoluciÃ³n |
|----------|----------------|----------|
| Error de conexiÃ³n a PostgreSQL | Contenedor no iniciado | `docker-compose restart postgres` |
| Puerto ya en uso | Otro servicio usando el puerto | Cambiar puertos en `.env` |
| Error de dependencias | Cache de Docker obsoleto | `docker-compose build --no-cache` |
| Permisos denegados | Problemas con volÃºmenes Docker | `sudo chmod -R 755 ./data` |

### Comandos de DepuraciÃ³n Ãštiles
```bash
# Ver logs especÃ­ficos de un servicio
docker-compose logs servicio-sela --tail=50

# Inspeccionar estado de contenedores
docker-compose ps

# Acceder a shell dentro de un contenedor
docker-compose exec servicio-sela sh

# Ver uso de recursos
docker-compose stats

# Limpiar recursos no utilizados
docker-compose down -v  # Â¡Cuidado: elimina volÃºmenes!
```

## ğŸ“Š Monitoreo y MÃ©tricas

### Endpoints de Salud
Cada servicio expone endpoints de monitoreo:
- `GET /health` - Estado general del servicio
- `GET /metrics` - MÃ©tricas de rendimiento
- `GET /info` - InformaciÃ³n de versiÃ³n y configuraciÃ³n

### MÃ©tricas Recomendadas
- Tiempo de respuesta por endpoint
- Tasa de Ã©xito de operaciones
- Uso de memoria y CPU por contenedor
- Conexiones activas a PostgreSQL

## ğŸ”’ Seguridad

### Buenas PrÃ¡cticas Implementadas
1. **ComunicaciÃ³n interna aislada** entre contenedores
2. **Credenciales separadas** por servicio
3. **Logs estructurados** sin informaciÃ³n sensible
4. **ValidaciÃ³n de entrada** en todos los endpoints

### Configuraciones de Seguridad CrÃ­ticas
```yaml
# EN PRODUCCIÃ“N, SIEMPRE:
# 1. Usar variables de entorno reales, no valores hardcodeados
# 2. Implementar autenticaciÃ³n entre servicios
# 3. Configurar HTTPS/TLS para comunicaciÃ³n externa
# 4. Regular acceso a la base de datos con IP filtering
# 5. Rotar credenciales regularmente
```

## ğŸ¤ ContribuciÃ³n

### Flujo de Trabajo
1. Fork del repositorio
2. Crear rama de feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit de cambios (`git commit -m 'AÃ±adir nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Crear Pull Request

### EstÃ¡ndares de CÃ³digo
- Usar nombres descriptivos para variables y funciones
- Comentar cÃ³digo complejo
- Mantener cobertura de tests > 80%
- Seguir PEP 8 para Python

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo la Licencia MIT. Ver el archivo `LICENSE` para mÃ¡s detalles.

## ğŸ“ Soporte y Contacto

- **Issues**: Reportar bugs o solicitar features en [GitHub Issues](https://github.com/javihgcorreo/prototipo-sela_beta/issues)
- **Email**: [Tu email o contacto]
- **DocumentaciÃ³n**: Actualizaciones en [wiki del repositorio]

---

## ğŸš¨ Notas Importantes

1. **Este es un prototipo** - No usar en producciÃ³n sin las debidas revisiones de seguridad
2. **Credenciales por defecto** - Cambiar todas las contraseÃ±as antes de despliegue
3. **Monitoreo recomendado** - Implementar sistema de alertas para producciÃ³n
4. **Backups esenciales** - Configurar backups regulares de la base de datos

## ğŸ”„ Historial de Versiones

- **v1.0.0** (04/02/2026): VersiÃ³n inicial del prototipo
  - 3 microservicios bÃ¡sicos
  - IntegraciÃ³n con PostgreSQL
  - Script de automatizaciÃ³n PowerShell

---

*Ãšltima actualizaciÃ³n: 4 de Febrero de 2026*  
*Estado del proyecto: Prototipo Beta*  
*PrÃ³ximas features: AutenticaciÃ³n JWT, Dashboard de monitoreo, API GraphQL*

Â¿Necesitas que ajuste alguna secciÃ³n especÃ­fica o que aÃ±ada mÃ¡s detalles sobre algÃºn componente?